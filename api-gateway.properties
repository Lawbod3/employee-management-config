# API GATEWAY
server.port=8084

# FORCE REACTIVE WEB APPLICATION TYPE (CRITICAL FOR GATEWAY)
spring.main.web-application-type=reactive

# REDIS CONFIGURATION FOR RATE LIMITING
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.timeout=2000ms

jwt.secret=bXlTZWNyZXRLZXlGb3JKV1RHZW5lcmF0aW9uSW5FbXBsb3llZU1hbmFnZW1lbnRTeXN0ZW0yMDI0

# ROUTING
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# AUTH SERVICE  - Higher limits for login/register
spring.cloud.gateway.routes[0].id=auth-service
spring.cloud.gateway.routes[0].uri=lb://auth-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/auth/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[0].filters[1]=name=RequestRateLimiter, args.redis-rate-limiter.replenishRate=10, \
  args.redis-rate-limiter.burstCapacity=20, args.key-resolver=#{@ipKeyResolver}

# EMPLOYEE SERVICE - Protected with authentication and lower limits
spring.cloud.gateway.routes[1].id=employee-service
spring.cloud.gateway.routes[1].uri=lb://employee-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/employees/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[1].filters[1]=AuthenticationFilter
spring.cloud.gateway.routes[1].filters[2]=name=RequestRateLimiter, args.redis-rate-limiter.replenishRate=5, \
  args.redis-rate-limiter.burstCapacity=15, args.key-resolver=#{@userKeyResolver}

# NOTIFICATION SERVICE
spring.cloud.gateway.routes[2].id=notification-service
spring.cloud.gateway.routes[2].uri=lb://notification-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/notifications/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=1
spring.cloud.gateway.routes[2].filters[1]=AuthenticationFilter
spring.cloud.gateway.routes[2].filters[2]=name=RequestRateLimiter, \
  args.redis-rate-limiter.replenishRate=5, \
  args.redis-rate-limiter.burstCapacity=15,\
  \ args.key-resolver=#{@userKeyResolver}